require 'vagrant-aws'

# https://github.com/mitchellh/vagrant-aws/issues/566
class Hash
  def slice(*keep_keys)
    h = {}
    keep_keys.each { |key| h[key] = fetch(key) if has_key?(key) }
    h
  end unless Hash.method_defined?(:slice)
  def except(*less_keys)
    slice(*keys - less_keys)
  end unless Hash.method_defined?(:except)
end

Vagrant.configure("2") do |config|
    config.env.enable #enable .env use
    config.vm.box = ENV["VM_BOX"]
    config.vm.provision :docker
    config.vm.provider :aws do |aws, override|
	    aws.access_key_id = ENV["AWS_ACCESS_KEY_ID"]
	    aws.secret_access_key = ENV["AWS_SECRET_ACCESS_KEY"]
	    aws.keypair_name = ENV["AWS_KEYPAIR_NAME"]
	    aws.instance_type = ENV["PROVIDER_INSTANCE_TYPE"]
	    aws.region = ENV["PROVIDER_REGION"]

	    aws.ami = ENV["PROVIDER_AMI"]
	    aws.security_groups = ENV["PROVIDER_SECURITY_GROUP"]
	    override.ssh.username = ENV["AWS_USER"]
	    override.ssh.private_key_path = ENV["AWS_KEY_PATH"]
    end
end

Vagrant.configure('2') do |config|
  config.env.enable #enable .env use
  config.vm.box = 'azure'
  config.vm.box_url = ENV["VM_BOX_URL"]
  config.ssh.private_key_path = ENV["SSH_KEY_PATH"]

  config.vm.define ENV["DROPLET_NAME"] do |azure|
    azure.vm.provider :azure do |azure, override|
      azure.tenant_id = ENV["AZURE_TENANT_ID"]
      azure.client_id = ENV["AZURE_CLIENT_ID"]
      azure.client_secret = ENV["AZURE_CLIENT_SECRET"]
      azure.subscription_id = ENV["AZURE_SUBSCRIPTION_ID"]

      azure.instance_ready_timeout = 600
      azure.vm_image_urn = ENV["PROVIDER_IMAGE"]
      azure.vm_name= ENV["DROPLET_NAME"]
    end

  azure.vm.provision "shell", inline: <<-SHELL
  echo -e "\nOpening port for service on #{ENV["DROPLET_PORT"]} ...\n"
  ufw allow "#{ENV["DROPLET_PORT"]}/tcp"
  echo ". $HOME/.bashrc" >> $HOME/.bash_profile
  echo -e "\nComplete\n"
  SHELL
  end
end
